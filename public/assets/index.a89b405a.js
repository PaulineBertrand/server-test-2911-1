var k=Object.defineProperty,R=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var N=(n,t,r)=>t in n?k(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,L=(n,t)=>{for(var r in t||(t={}))E.call(t,r)&&N(n,r,t[r]);if(I)for(var r of I(t))O.call(t,r)&&N(n,r,t[r]);return n},S=(n,t)=>R(n,T(t));import{r as c,j as b,N as m,a as P,u as U,b as j,O as A,R as M,c as h,d as B,e as D,B as H}from"./vendor.68b2a401.js";const V=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}};V();const C=c.exports.createContext(),x=()=>c.exports.useContext(C);const e=b.exports.jsx,l=b.exports.jsxs,f=b.exports.Fragment,$=()=>{const{isLoggedIn:n,currentUser:t,removeUser:r}=x();return l("nav",{className:"NavMain",children:[e(m,{className:"logo",to:"/",children:"App name"}),n&&l(f,{children:[e(m,{to:"/profile",children:t&&t.email}),e("button",{onClick:r,children:"Log-Out"})]}),!n&&l(f,{children:[e(m,{to:"/signin",children:"Log in"}),e(m,{to:"/signup",children:"Sign Up"})]})]})},q=()=>e("div",{children:e("h1",{children:"Welcome \u{1F3E1}"})}),F=n=>{const[t,r]=c.exports.useState(n);return[t,s=>{r(S(L({},t),{[s.target.name]:s.target.value}))}]},v=P.create({baseURL:"https://test-2911-2.herokuapp.com",withCredentials:!0});//! Error handling to use in the catch
function w(n){throw n.response.data&&console.log(n.response&&n.response.data),n}const y=S(L({},v),{signup(n){return v.post("/api/auth/signup",n).then(t=>t.data).catch(w)},isLoggedIn(n){return v.get("/api/auth/me",{headers:{Authorization:`Bearer ${n}`}}).then(t=>t.data).catch(w)},signin(n){return v.post("/api/auth/signin",n).then(t=>t.data).catch(w)}}),z=()=>{const[{email:n,password:t},r]=F({email:"",password:""}),[a,s]=c.exports.useState(null),o=U(),{storeToken:i,authenticateUser:d}=x(),u=p=>{p.preventDefault(),y.signin({email:n,password:t}).then(g=>{console.log(g),i(g.authToken),d(),o("/")}).catch(g=>{s(g.response.data)})};return l(f,{children:[a&&e("h3",{className:"error",children:a.message}),l("form",{onSubmit:u,children:[e("h2",{children:"Signin"}),e("label",{htmlFor:"email",children:"Email"}),e("input",{type:"email",id:"email",name:"email",onChange:r,value:n}),e("label",{htmlFor:"password",children:"Password"}),e("input",{type:"password",id:"password",name:"password",onChange:r,value:t}),e("button",{children:"Submit"})]})]})},K=()=>e(z,{}),W=()=>{const[n,t]=F({name:"",email:"",password:""}),[r,a]=c.exports.useState(null),s=U(),o=i=>{i.preventDefault(),y.signup(n).then(()=>{s("/signin")}).catch(d=>{a(d.response.data)})};return l(f,{children:[r&&e("h3",{className:"error",children:r.message}),l("form",{onSubmit:o,children:[e("h2",{children:"Signup"}),e("label",{htmlFor:"name",children:"Name"}),e("input",{onChange:t,value:n.name,type:"text",id:"name",name:"name"}),e("label",{htmlFor:"email",children:"Email"}),e("input",{onChange:t,value:n.email,type:"email",id:"email",name:"email"}),e("label",{htmlFor:"password",children:"Password"}),e("input",{onChange:t,value:n.password,type:"password",id:"password",name:"password"}),e("button",{children:"Submit"})]})]})},G=()=>e(W,{}),J=()=>e("div",{children:e("p",{children:"This is a protected profile"})}),Q=()=>{const{isLoggedIn:n,isLoading:t}=x();return t?e("p",{children:"Loading..."}):n?e(A,{}):e(j,{to:"/login"})};function X(){return l("div",{className:"App",children:[e($,{}),l(M,{children:[e(h,{path:"/",element:e(q,{})}),e(h,{path:"/signin",element:e(K,{})}),e(h,{path:"/signup",element:e(G,{})}),e(h,{element:e(Q,{}),children:e(h,{path:"/profile",element:e(J,{})})})]})]})}const Y=({children:n})=>{const[t,r]=c.exports.useState({currentUser:null,isLoading:!0,isLoggedIn:!1});c.exports.useEffect(()=>{a()},[]);const a=()=>{const u=localStorage.getItem("authToken");u?y.isLoggedIn(u).then(p=>{r({currentUser:p,isLoading:!1,isLoggedIn:!0})}).catch(p=>{r({currentUser:null,isLoading:!1,isLoggedIn:!1})}):r({currentUser:null,isLoading:!1,isLoggedIn:!1})},s=()=>{o(),a()},o=()=>{localStorage.removeItem("authToken")},i=u=>{localStorage.setItem("authToken",u)},d={currentUser:t.currentUser,isLoading:t.isLoading,isLoggedIn:t.isLoggedIn,removeUser:s,storeToken:i,authenticateUser:a};return e(C.Provider,{value:d,children:n})};B.render(e(D.StrictMode,{children:e(H,{children:e(Y,{children:e(X,{})})})}),document.getElementById("root"));
